<style type="text/css">
code{
  font-family: "Consolas", monospace;
}
pre{
  border: 1px solid #ddd;
  border-left: 3px solid #f36d33;
  overflow: auto;
  padding: 1em 1.5em;
  display: block;
}
Blockquote{
  border-left: 3px solid #d0d0d0;
  padding-left: 0.5em;
  margin-left:1em;
}
Blockquote p{
  margin: 0;
}
table{
  border:1px solid;
  border-collapse:collapse;
}
th{  padding:5px;
  border:1px solid;
}
td{
  padding:5px;
  border:1px solid;
}
</style>
<h1>Delphi SAML implementation</h1>
<p><a href="https://opensource.org/licenses/Apache-2.0"><img src="https://img.shields.io/badge/License-Apache_2.0-blue.svg" alt="License"/></a></p>
<p><strong>Delphi SAML</strong> is a SAML implementation written on top of <a href="https://www.aleksey.com/xmlsec/">xmlsec</a>. The basic idea behind the code comes from <a href="https://github.com/monmohan/samltools">samltools</a>.</p>
<p>Supported Delphi versions: from Delphi 10.1 to Delphi 13</p>
<p><img src="./Docs/SupportingDelphi.jpg" alt="./Docs/SupportingDelphi"/></p>
<h2>How to setup a service provider locally?</h2>
<ul>
<li>Clone the repo</li>
<li>Copy all the DLL in the Demos\bin folder (see <em>installation</em>)</li>
<li>Setup a loopback mapping to &ldquo;sp.samltools.com&rdquo;. On windows:</li>
<li>Open <code>C:\Windows\System32\drivers\etc\hosts</code></li>
<li>Add <code>127.0.0.1 sp.samltools.com</code></li>
<li>Compile Demos\SAML\SPDemo.dpr</li>
<li>Run it</li>
<li>Choose <code>idp-auth0.ini</code> in Identity Provider settings</li>
<li>Choose <code>sp-auth0.ini</code> in Serivce Provider settings</li>
<li>Click <code>Open Browser</code> and follow the instructions</li>
</ul>
<h2>Demo</h2>
<p><img src="./Docs/SPDemo.gif" alt="SPDemo!"/></p>
<h2>Installation</h2>
<p>Download the zip files for your platform and extract all DLLs into the demos\bin folder.
You can found the precompiled binaries of the DLL here:</p>
<ul>
<li><em>32bit</em>: https://www.zlatkovic.com/pub/libxml/</li>
<li><em>64bit</em>: https://www.aleksey.com/xmlsec/download/win64/</li>
</ul>
<p>The required DLL are:</p>
<ul>
<li><code>libxmlsec.dll</code>: main DLL<ul>
<li><code>libxml2.dll</code>: to handle XML<ul>
<li><code>iconv.dll</code>: to convert between charsets</li>
</ul>
</li>
<li><code>libxmlsec-mscrypto.dll</code>: if you want to use cryptographics functions from <em>msCrypto</em> (install msCrypto from MS)</li>
<li><code>libxmlsec-openssl.dll</code>: or if you want to use cryptographics functions from <em>OpenSSL</em><ul>
<li><code>libeay32.dll</code></li>
<li><code>ssleay32.dll</code></li>
</ul>
</li>
</ul>
</li>
<li><code>zlib1.dll</code>: compression&hellip; but I'm not sure who need it</li>
<li><code>libexslt.dll</code>: xsl transformations (optional)</li>
<li><code>libxslt.dll</code>: xsl transformations (optional)</li>
</ul>
<p>If you want you can extract <code>xmlsec.exe</code> and <code>openssl.exe</code>. The first can be used to test XML signing and encryption, and the second to handle certificates and cryptography.</p>
<h2>TODO</h2>
<ul>
<li>ðŸ“Œ Better metadata support</li>
<li>âœ¨ Identity provider implementation</li>
<li>âœ¨ Basic key format conversion (PEM, DER, &hellip;)</li>
</ul>
<h2>Documentation</h2>
<p><code>Delphi SAML</code> consists of some modules:</p>
<ul>
<li>The cryptographic units: used to handle signing and encryption</li>
<li>The SAML message units: to build request and parse response</li>
<li>The metadata unit: to read and write metadata</li>
<li>The demos: to see how <code>Delphi SAML</code> works</li>
</ul>
<p>If you need more help you can read the <a href="Docs/APIDoc.md">API documentation</a>.</p>
<h2>License</h2>
<p><code>Delphi SAML</code> is released under the term of the <em>Apache License</em>. Here follows the licenses of all dependencies:</p>
<table>
  <tr>
    <th>Library</th>
    <th>License</th>
    <th>Using with proprietary applications/libraries</th>
  </tr>
  <tr>
    <td>xmlsec-core</td>
    <td>MIT license</td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>xmlsec-openssl</td>
    <td>OpenSSL License</td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>xmlsec-mscrypto</td>
    <td>Microsoft licensing: The libraries are part of MS Windows, and are also distributed with Internet Explorer.</td>
    <td>Unknown</td>
  </tr>
  <tr>
    <td>libxml2</td>
    <td>MIT license</td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>iconv</td>
    <td>LGPL</td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>openssl</td>
    <td>Apache-2.0 license</td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>zlib1</td>
    <td>Zlib license</td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>libexslt</td>
    <td>MIT License</td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>libxslt</td>
    <td>MIT License</td>
    <td>Yes</td>
  </tr>
</table>
<h2>Resources</h2>
<p>SAML documentation:</p>
<ul>
<li>http://docs.oasis-open.org/security/saml/v2.0/saml-2.0-os.zip</li>
<li>https://developer.okta.com/docs/concepts/saml/</li>
<li>https://shibboleth.atlassian.net/wiki/spaces/CONCEPT/overview</li>
<li>https://en.wikipedia.org/wiki/SAML_2.0</li>
</ul>
<p>XML-Sec API:</p>
<ul>
<li>https://www.aleksey.com/xmlsec/api/</li>
</ul>
<p>Resources:</p>
<ul>
<li>https://samltest.id/</li>
<li>https://www.samltool.com/online_tools.php</li>
<li>https://github.com/monmohan/samltools</li>
</ul>
<h2>Generate the keys</h2>
<p>If you want to sign you request you need a private and a public key. You can generate both with this command:</p>
<pre><code class="">keygen.bat -h sp.samltools.com -e urn:msingh.samltools:sp -y 10
</code></pre>
<p>See <a href="Docs/CommandLine.md">command line</a> for further detail.</p>
<p>Release Notes:
ver.1.3.0 - 13 Mar 2023</p>
<ul>
<li>64bit support</li>
<li>support for xmlsec 1.3</li>
<li>New SAML.inc file to use the right version of the DLLs bindings</li>
<li>Better demo</li>
<li>Support for encrypted private keys</li>
</ul>
<p>ver.1.2.0 - 11 Jul 2023</p>
<ul>
<li>Certificates and keys can be loaded from a buffer</li>
<li>SP configuration improvement: NameIdFormat, Comparison, IssuerNameQualifier, IssuerFormat</li>
<li>Support for signatures in nodes different from the root node</li>
</ul>
<p>ver.1.1.0 - 1 Apr 2023</p>
<ul>
<li>SPID support (Italy's public digital identity)</li>
<li>Support for HTTP-POST binding</li>
<li>New AuthnRequest attribute &ldquo;AuthnContext&rdquo;</li>
</ul>
<p>ver.1.0.0 - 24 Oct 2022</p>
<ul>
<li>First stable version</li>
</ul>
